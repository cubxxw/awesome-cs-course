+ [author](https://github.com/3293172751)
+ <a href="https://github.com/3293172751" target="_blank"><img src="https://img.shields.io/badge/Github-xiongxinwei-inactive?style=social&logo=github"></a></p>

# ç¬¬32èŠ‚ Mybatis

+ [å›åˆ°ç›®å½•](../README.md)
+ [å›åˆ°é¡¹ç›®é¦–é¡µ](../../README.md)
+ [ä¸Šä¸€èŠ‚](31.md)
> â¤ï¸ğŸ’•ğŸ’•javaçš„å­¦ä¹ æŒ‡å—,ä»å…¥é—¨åˆ°å¤§å¸ˆç¯‡ç« ã€‚Myblog:[http://nsddd.top](http://nsddd.top/)
---
[TOC]

## mybitsæ˜¯ä»€ä¹ˆï¼Ÿ

+ [x] [å®˜æ–¹æ–‡æ¡£](https://mybatis.org/mybatis-3/zh/index.html)

`Mybits`æ˜¯ä¸€æ¬¾ä¼˜ç§€çš„æŒä¹…æ€§æ¡†æ¶ï¼Œç”¨äºç®€åŒ–`JDBC`å¼€å‘

> JDBCç¼ºç‚¹ï¼š
>
> 1. ç¡¬ç¼–ç ï¼ˆä¿®æ”¹éº»çƒ¦ â€“ å°†ä»£ç å†™æ­»ï¼‰
>    + æ³¨å†Œé©±åŠ¨ï¼Œè·å–é“¾æ¥
>    + sqlè¯­å¥
> 2. æ“ä½œç¹ç
>    + æ‰‹åŠ¨è®¾ç½®å‚æ•°
>    + æ‰‹åŠ¨å°è£…ç»“æœé›†

`Javaee`ä¸‰å±‚æ¶æ„ï¼š

+ è¡¨ç°å±‚
+ ä¸šåŠ¡å±‚
+ æŒä¹…å±‚



## æ¡†æ¶æ˜¯ä»€ä¹ˆï¼Ÿ

æ¡†æ¶æ˜¯ä¸€ä¸ªåŠæˆå“è½¯ä»¶ï¼Œæ˜¯ä¸€å¥—å¯é‡ç”¨çš„ã€é€šç”¨çš„ã€è½¯ä»¶åŸºç¡€ä»£ç æ¨¡å‹

åœ¨æ¡†æ¶åŸºç¡€ä¹‹ä¸Šæ„å»ºè½¯ä»¶ç¼–å†™æ›´åŠ é«˜æ•ˆã€è§„èŒƒã€é€šç”¨ã€å¯æ‰©å±•

> å°±æ˜¯ç”¨å°‘é‡çš„å·¥ä½œå®ç°ä¸€ä¸ªå¤æ‚çš„ä¸šåŠ¡
>
> `mybatis`å…é™¤äº†å‡ ä¹æ‰€æœ‰çš„`JDBC`ä»£ç ä»¥åŠè®¾ç½®å‚æ•°å’Œè·å–ç»“æœé›†çš„å·¥ä½œã€‚



## mybabiså¿«é€Ÿå…¥é—¨

```mysql
create database mybatis;
use mybatis;

drop table if exists tb_user;
# å¦‚æœè¿™ä¸ª tb_user è¡¨å­˜åœ¨ï¼Œå°±åˆ é™¤è¿™ä¸ªè¡¨

create table tb_user (
    id int primary key auto_increment,
  	username varchar(20),
    password varchar(20),
    gender char(1),
    addr varchar(30)
);
```

**æ·»åŠ å­—æ®µï¼š**

```mysql
insert into tb_user values (1, 'zhangsan','123' , 'ç”·', 'åŒ—äº¬');
insert into tb_user values (2, "æå››", '234', 'å¥³', 'å¤©æ´¥');
insert into tb_user values (3, "ç‹äº”", '11', 'å¥³', 'è¥¿å®‰'),(4, "ç†ŠæŸäºº", '20', 'ç”·', 'æ­¦æ±‰');
```

**æŸ¥è¯¢ï¼š**

![image-20221008201911392](http://sm.nsddd.top/smimage-20221008201911392.png?xxw@nsddd.top)



## å…¥é—¨

### å®‰è£…mybatis

è¦ä½¿ç”¨ MyBatisï¼Œ åªéœ€å°† [mybatis-x.x.x.jar](https://github.com/mybatis/mybatis-3/releases) æ–‡ä»¶ç½®äºç±»è·¯å¾„ï¼ˆclasspathï¼‰ä¸­å³å¯ã€‚

å¦‚æœä½¿ç”¨ Maven æ¥æ„å»ºé¡¹ç›®ï¼Œåˆ™éœ€å°†ä¸‹é¢çš„ä¾èµ–ä»£ç ç½®äº pom.xml æ–‡ä»¶ä¸­ï¼š

```xml
<dependency>
  <groupId>org.mybatis</groupId>
  <artifactId>mybatis</artifactId>
  <version>x.x.x</version>
</dependency>
```



## æ·»åŠ ä¾èµ–

```xml
<dependencies>
    <!-- mybatisæ ¸å¿ƒåŒ… -->
    <dependency>
        <groupId>org.mybatis</groupId>
        <artifactId>mybatis</artifactId>
        <version>3.5.1</version>
    </dependency>
    <!-- mysqlé©±åŠ¨åŒ… -->
    <dependency>
        <groupId>mysql</groupId>
        <artifactId>mysql-connector-java</artifactId>
        <version>8.0.13</version>
    </dependency>
    <!-- junitæµ‹è¯• -->
    <dependency>
        <groupId>junit</groupId>
        <artifactId>junit</artifactId>
        <version>4.11</version>
    </dependency>
</dependencies>
```



## åœ¨resourcesç›®å½•ä¸‹é¢åˆ›å»ºæ–‡ä»¶

> ï¼ˆåç§°ä¸å›ºå®šï¼‰ï¼Œè¯¥æ–‡ä»¶æ˜¯ Mybatis æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼Œé…ç½®æ–‡ä»¶å†…å®¹ä¸ºæ•°æ®æºã€äº‹åŠ¡ç®¡ç†ã€‚

![image-20221009105855242](./images/image-20221009105855242.png)

**mybatis-configæ–‡ä»¶**

> ä¹ æƒ¯ä¸Šæ˜¯è¿™ä¹ˆå‘½åçš„ï¼Œå¹¶éå¼ºåˆ¶è¦æ±‚çš„ï¼Œæ•´åˆ`spring`åè¿™ä¸ªé…ç½®æ–‡ä»¶å¯ä»¥å¿½ç•¥æ‰ï¼Œæ‰€ä»¥æ“ä½œçš„æ—¶å€™ç›´æ¥å¤åˆ¶ã€ç²˜è´´ã€‚
>
> å­˜æ”¾çš„åœ°æ–¹åœ¨`resources/mybatis-config`

```xml
<?xml version="1.0" encoding="UTF-8" ?> <!--å£°æ˜-->
<!DOCTYPE configuration   <!--configurationä¸»æ ‡ç­¾ï¼Œå’Œmappersæ ‡ç­¾-->
        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-config.dtd">
<!--dtdæ˜¯çº¦æŸ-->
<configuration>
    <!-- å¼•ç”¨ jdbc.properties é…ç½®æ–‡ä»¶ -->
    <properties resource="jdbc.properties"/>

    <!-- typeAliases è®¾ç½®ç±»å‹åˆ«å -->
    <typeAliases>
        <typeAlias alias="User" type="org.example.User"/>
   </typeAliases>

    <!-- environments ç¯å¢ƒé…ç½® -->
    <environments default="development">
        <environment id="development">
            <!-- ä½¿ç”¨jdbcäº‹åŠ¡ç®¡ç† ä»¥jdbcæ¥å¤„ç†çš„-->
            <transactionManager type="JDBC"/>
            <!-- æ•°æ®åº“è¿æ¥æ±  -->
            <!-- æ•°æ®åº“è¿æ¥ç›¸å…³é…ç½® ,è¿™é‡ŒåŠ¨æ€è·å–jdbc.propertiesæ–‡ä»¶ä¸­çš„å†…å®¹-->
            <dataSource type="POOLED">
                <property name="driver" value="com.mysql.jdbc.Driver"/>
                <property name="url" value="jdbc:mysql://localhost:3306"/>
                <property name="username" value="root"/>
                <property name="password" value="$123456"/>
            </dataSource>
        </environment>
    </environments>

    <!-- åŠ è½½ mapper æ˜ å°„æ–‡ä»¶ -->
    <mappers>
        <mapper resource="UserMapper.xml"/>
    </mappers>
</configuration>
```

> åˆ›å»ºæ˜ å°„æ–‡ä»¶ï¼Œæ³¨æ„åˆ›å»ºæ˜ å°„æ–‡ä»¶åä¸€å®šè¦å¼•å…¥åˆ°`mappers`ä¸­



**å¼•ç”¨ jdbc.properties æ–‡ä»¶**ï¼Œè¯»å–é…ç½®æ–‡ä»¶ä¸­çš„å±æ€§

> åœ¨ resource æ–‡ä»¶å¤¹æ–°å»º jdbc.properties é…ç½®æ–‡ä»¶ï¼Œä¿å­˜é…ç½®ç›¸å…³çš„ä¿¡æ¯ã€‚
>
> `JDBC` è¿æ¥ `MySQL5` ä½¿ç”¨é©±åŠ¨åŒ… `com.mysql.jdbc.Driver`ï¼Œ`JDBC` è¿æ¥ `MySQL6` åŠä»¥ä¸Šä½¿ç”¨é©±åŠ¨åŒ… `com.mysql.cj.jdbc.Driver`ï¼Œä¸”éœ€è¦æŒ‡å®šæ—¶åŒº `serverTimezone`ã€‚

```mysql
# mysqlé©±åŠ¨åŒ…å
driver=com.mysql.cj.jdbc.Driver
# æ•°æ®åº“è¿æ¥åœ°å€
url=jdbc:mysql://localhost:3306/demo_1? serverTimezone=GMT &useUnicode=true& characterEncoding=utf8
# ç”¨æˆ·å
username=root
# å¯†ç 
password=123456
```



**typeAliases è®¾ç½®ç±»å‹åˆ«å**

ç±»å‹åˆ«åæ˜¯ä¸º Java ç±»è®¾ç½®ä¸€ä¸ªçŸ­çš„åå­—ï¼ˆå¤§å°å†™ä¸æ•æ„Ÿï¼‰ï¼Œç”¨æ¥å‡å°‘ç±»å®Œå…¨é™å®šåçš„å†—ä½™ã€‚

```xml
<typeAliases>
    <typeAlias alias="User" type="com.noteligible.pojo.User"/>
</typeAliases>
```

ä½†ä¸€èˆ¬æ¥è¯´pojoéƒ½ä¼šæœ‰å¾ˆå¤šï¼Œ æ‰€ä»¥ `mybatis` æ”¯æŒæŒ‡å®šåŒ…åï¼Œæ‰¹é‡æŒ‡å®šåˆ«åï¼Œæ‰«ææ•´ä¸ªåŒ…ä¸‹çš„ç±»ã€‚

```xml
<typeAliases>
    <package name="com.noteligible.pojo"/>
    <!-- å…¶ä»–åŒ… -->
</typeAliases>
```



**environments ç¯å¢ƒé…ç½®**

> environments å¯¹åº”çš„æ˜¯æ•°æ®åº“ç›¸å…³çš„å±æ€§ã€‚æˆ‘ä»¬å¯ä»¥é…ç½®å¤šä¸ªç¯å¢ƒï¼Œä½†æ¯ä¸ª SqlSessionFactory å®ä¾‹åªèƒ½é€‰æ‹©å…¶ä¸€ï¼Œå’Œspringæ•´åˆå environmentsé…ç½®å°†åºŸé™¤ã€‚



**åŠ è½½ mappers æ˜ å°„æ–‡ä»¶**

> åŠ è½½sqlçš„æ˜ å°„æ–‡ä»¶ â€” å¯¹åº”çš„æ–‡ä»¶ â€“ çœ‹å®˜ç½‘

**æ–°å»ºæ–‡ä»¶`UserMapper.xml`**   ï¼š`User`æ˜¯æˆ‘çš„è¡¨åç§°

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
    namespca: å‘½åç©ºé—´  åé¢ä¼šè¯¦ç»†è®²
    id: sqlçš„å”¯ä¸€æ ‡è¯†  ä¸èƒ½é‡å¤
    parameterType: å‚æ•°ç±»å‹
    resultType: è¿”å›å€¼ç±»å‹ï¼Œ å¯¹åº”çš„æ˜¯åŒ…è·¯å¾„  org.example.User
-->
<mapper namespace="org.mybatis.example.BlogMapper">
    <select id="selectall" resultType="org.example.User">
        select * from tb_user;
    </select>
</mapper>
```



æ–¹æ³•ä¸€ï¼šä½¿ç”¨ç›¸å¯¹äºç±»è·¯å¾„åŠ è½½å•ä¸ªæ˜ å°„æ–‡ä»¶

```html
<mappers>
    <mapper resource="com/noteligible/mapper/UserMapper.xml"/>
</mappers>
```



æ–¹æ³•äºŒï¼šä½¿ç”¨`mapper`æ¥å£ç±»è·¯å¾„åŠ è½½å•ä¸ªæ˜ å°„æ–‡ä»¶

ï¼ˆæ­¤æ–¹æ³•è¦æ±‚`mapper`æ¥å£åç§°å’Œ`mapper`æ˜ å°„æ–‡ä»¶åç§°ç›¸åŒï¼Œä¸”æ”¾åœ¨åŒä¸€ä¸ªç›®å½•ä¸­ï¼‰

```xml
<mappers>
    <mapper class="com.noteligible.mapper.UserMapper"/>
</mappers>
```



æ–¹æ³•ä¸‰ï¼šæŒ‡å®šåŒ…åæ‰¹é‡åŠ è½½æ˜ å°„æ–‡ä»¶ ï¼Œè¯¥é…ç½®ä¼šæ‰«ææŒ‡å®šåŒ…ä¸­çš„æ‰€æœ‰ `.xml` æ–‡ä»¶ã€‚

ï¼ˆæ­¤æ–¹æ³•è¦æ±‚`mapper`æ¥å£åç§°å’Œ`mapper`æ˜ å°„æ–‡ä»¶åç§°ç›¸åŒï¼Œä¸”æ”¾åœ¨åŒä¸€ä¸ªç›®å½•ä¸­ï¼‰

```xml
<mappers>
    <package name="com.noteligible.mapper"/>
</mappers>
```




## ç¼–å†™ç¨‹åº

![image-20221009120350150](./images/image-20221009120350150.png)

**æ–°å»º`User`ç±»**

```java
package org.example;

public class User {
    private Integer id;
    private String username;
    private String password;
    private String gender;

    private String addr;

    public User(Integer id, String username, String password, String gender, String addr) {
        this.id = id;
        this.username = username;
        this.password = password;
        this.gender = gender;
        this.addr = addr;
    }

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public String getUsername() {
        return username;
    }

    public void setUsername(String username) {
        this.username = username;
    }

    public String getPassword() {
        return password;
    }

    public void setPassword(String password) {
        this.password = password;
    }

    public String getGender() {
        return gender;
    }

    public void setGender(String gender) {
        this.gender = gender;
    }

    public String getAddr() {
        return addr;
    }

    public void setAddr(String addr) {
        this.addr = addr;
    }

    @Override
    public String toString() {
        return "User{" +
                "id=" + id +
                ", username='" + username + '\'' +
                ", password='" + password + '\'' +
                ", gender='" + gender + '\'' +
                ", addr='" + addr + '\'' +
                '}';
    }
}
```



### åˆ›å»ºæµ‹è¯•ç±»

**å°†ä¸‹é¢çš„å†…å®¹ç²˜è´´åˆ°æµ‹è¯•æ–‡ä»¶`top.nsddd.Mybatis`**

```java
String resource = "org/mybatis/example/mybatis-config.xml";
InputStream inputStream = Resources.getResourceAsStream(resource);
SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream);
```

`Mybatis`

```java
package top.nsddd;
/*
* mybatiså…¥é—¨ä»£ç 
*/
public class mybatis {
    String resource = "mybatis-config.xml";
    InputStream inputStream = Resources.getResourceAsStream(resource);
    SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream);
}
```



## mybatisæ˜ å°„æ–‡ä»¶

**ç›¸å…³æ¦‚å¿µï¼šORM â€“ å…³ç³»å¯¹è±¡æ˜ å°„**

+ å¯¹è±¡ï¼š Javaå®ä½“ç±»å¯¹è±¡
+ å…³ç³»ï¼šå…³ç³»å‹æ•°æ®åº“
+ æ˜ å°„ï¼šä¸¤è€…ä¹‹é—´çš„å…³ç³»



### å‘½åè§„åˆ™

1. `mybatis`ä¸­æ”¯æŒé¢å¯¹æ¥å£çš„æ•°æ®æ“ä½œï¼Œè¦ä¿è¯ä¸¤ä¸ªä¸€è‡´ï¼š
   1. `a > mapper`æ¥å£çš„å…¨ç±»åå’Œæ˜ å°„æ–‡ä»¶çš„å‘½åç©ºé—´ï¼ˆ`namespace`ï¼‰ä¿æŒä¸€è‡´
   2. `b > mapper`æ¥å£çš„æ–¹æ³•çš„æ–¹æ³•åå’Œæ˜ å°„æ–‡ä»¶ä¸­ç¼–å†™çš„SQLçš„æ ‡ç­¾çš„`id`å±æ€§ä¿æŒä¸€è‡´
2. è¡¨åç§°æ‰€å¯¹åº”çš„`å®ä½“ç±»çš„ç±»å + Mapper.xml`

![image-20221009181612461](./images/image-20221009181612461.png)



## æ·»åŠ Javaæ˜ å°„æ–‡ä»¶







## END é“¾æ¥

+ [å›åˆ°ç›®å½•](../README.md)
+ [ä¸Šä¸€èŠ‚](31.md)
+ [ä¸‹ä¸€èŠ‚](33.md)
---
+ [å‚ä¸è´¡çŒ®â¤ï¸ğŸ’•ğŸ’•](https://github.com/3293172751/Block_Chain/blob/master/Git/git-contributor.md)