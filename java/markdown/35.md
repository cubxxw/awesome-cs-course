+ [author](https://github.com/3293172751)
+ <a href="https://github.com/3293172751" target="_blank"><img src="https://img.shields.io/badge/Github-xiongxinwei-inactive?style=social&logo=github"></a></p>
# ç¬¬35èŠ‚ åŠ¨æ€sql
+ [å›åˆ°ç›®å½•](../README.md)
+ [å›åˆ°é¡¹ç›®é¦–é¡µ](../../README.md)
+ [ä¸Šä¸€èŠ‚](34.md)
> â¤ï¸ğŸ’•ğŸ’•javaçš„å­¦ä¹ æŒ‡å—,ä»å…¥é—¨åˆ°å¤§å¸ˆç¯‡ç« ã€‚Myblog:[http://nsddd.top](http://nsddd.top/)
---
[TOC]

## mybatisè·å–å‚æ•°å€¼çš„ä¸¤ç§æ–¹å¼

mybatisè·å–å‚æ•°å€¼çš„ä¸¤ç§æ–¹å¼ï¼š`${}`å’Œ`#{}`

+ `${}` çš„æœ¬è´¨å°±æ˜¯å­—ç¬¦ä¸²æ‹¼æ¥
+ `#{}` çš„æœ¬è´¨å°±æ˜¯å ä½ç¬¦èµ‹å€¼

> å ä½ç¬¦èµ‹å€¼è¿˜èƒ½é¿å…`SQL`æ³¨å…¥



ğŸ’¡ç®€å•çš„ä¸€ä¸ªæ¡ˆä¾‹å¦‚ä¸‹ï¼š

ç¬¬ä¸€ç§æ–¹å¼ï¼š

```xml
<select id="getUserList" resultType="User">
    select * from tb_user where username = #{username}
</select>
```

> æˆ‘ä»¬ä¼ å…¥çš„æ–¹å¼æ˜¯ä¸Šé¢ç”¨æˆ·åï¼Œè¿™ä¸ªå‚æ•°å¯ä»¥æ˜¯ä»»æ„å†…å®¹è·å–ï¼Œä½†æ˜¯å»ºè®®ç”¨æœ‰æ„ä¹‰çš„å‚æ•°
>
> æœ¬è´¨æ˜¯å ä½ç¬¦



ç¬¬äºŒç§æ–¹å¼

```xml
 <select id="getUserList" resultType="User">
     select * from tb_user where username = '${username}'
 </select>
```

> æœ¬è´¨æ˜¯å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œè¿™ä¸ª**ä¸€å®šè¦æ³¨æ„å•å¼•å·ï¼ˆå­—ç¬¦ä¸²æ‹¼æ¥ï¼‰**



## æ³¨è§£





## ä»€ä¹ˆæ˜¯åŠ¨æ€sqlï¼Ÿ

mybatisæ ¸å¿ƒ:å¯¹sqlè¯­å¥è¿›è¡Œçµæ´»æ“ä½œï¼Œé€šè¿‡è¡¨è¾¾å¼è¿›è¡Œåˆ¤æ–­ï¼Œå¯¹sqlè¿›è¡Œçµæ´»æ‹¼æ¥ã€ç»„è£…ã€‚



## ifåˆ¤æ–­

### UserMapper.xml

```java
<!--ç”¨æˆ·ç»¼åˆæŸ¥è¯¢-->
    <select id="findUserList" parameterType="cn.edu.wtu.po.UserQueryVo" resultType="cn.edu.wtu.po.UserCustom">
        select * from user
        <where>
            <if test="userCustom!=null">
            <if test="userCustom.sex!=null and userCustom.sex!=''">
                and user.sex = ##{userCustom.sex}
            </if>
            <if test="userCustom.username!=null and userCustom.username!=''">
                and user.username LIKE '%${userCustom.username}%'
            </if>
            </if>
        </where>
    </select>
    <!--ç”¨æˆ·ç»¼åˆæŸ¥è¯¢æ€»æ•°-->
    <select id="findUserCount" parameterType="cn.edu.wtu.po.UserQueryVo" resultType="java.lang.Integer">
                SELECT count(*) FROM user
                <where>
                    <if test="userCustom!=null">
                        <if test="userCustom.sex!=null and userCustom.sex!=''">
                            and user.sex = ##{userCustom.sex}
                        </if>
                        <if test="userCustom.username!=null and userCustom.username!=''">
                            and user.username LIKE '%${userCustom.username}%'
                        </if>
                    </if>
                </where>
    </select>
```

### æµ‹è¯•ç»“æœ

#### 1.æ³¨é‡Šæ‰`testFindUserList()`æ–¹æ³•ä¸­çš„`userCustom.setUsername("å¼ ä¸‰");`

UserMapperTest.java

```java
//ç”±äºè¿™é‡Œä½¿ç”¨åŠ¨æ€sqlï¼Œå¦‚æœä¸è®¾ç½®æŸä¸ªå€¼ï¼Œæ¡ä»¶ä¸ä¼šæ‹¼æ¥åœ¨sqlä¸­
userCustom.setSex("1");
// userCustom.setUsername("æ™“æ˜");
userQueryVo.setUserCustom(userCustom);
```

è¾“å‡º

```
DEBUG [main] - Created connection 1293618474.
DEBUG [main] - Setting autocommit to false on JDBC Connection [com.mysql.jdbc.JDBC4Connection@4d1b0d2a]
DEBUG [main] - ==>  Preparing: select * from user WHERE user.sex = ? 
DEBUG [main] - ==> Parameters: 1(String)
DEBUG [main] - <==      Total: 9
[id:10
username:å¼ ä¸‰
sex:1
birthday:Wed Nov 06 00:00:00 CST 2019
address:åŒ—äº¬å¸‚, id:22
username:å¼ æ™“æ˜
sex:1
birthday:Tue Nov 26 00:00:00 CST 2019
address:å¤©æ´¥, id:24
username:é™ˆæ™“æ˜
sex:1
birthday:Tue Apr 04 00:00:00 CST 2017
address:é‡åº†, id:26
username:å°æ˜
sex:1
birthday:Tue Jul 24 00:00:00 CST 2018
address:æ­¦æ±‰, id:28
username:ææ¢…æ¢…
sex:1
birthday:Wed Jul 26 00:00:00 CST 2000
address:è¥¿å®‰, id:32
username:æ±Ÿæ±Ÿ
sex:1
birthday:Wed Jul 05 00:00:00 CST 2017
address:å®å¤, id:33
username:çº¢çº¢
sex:1
birthday:Tue Jun 20 00:00:00 CST 2017
address:å¹¿å·, id:34
username:æœ¨æœ¨
sex:1
birthday:Tue Apr 26 00:00:00 CST 2016
address:æ²³åŒ—, id:37
username:é™ˆæ™“æ˜
sex:1
birthday:Wed Nov 27 00:00:00 CST 2019
address:null]
```

å¯ä»¥çœ‹åˆ°sqlè¯­å¥ä¸º`reparing: SELECT * FROM user WHERE user.sex=? `ï¼Œæ²¡æœ‰usernameçš„éƒ¨åˆ†


#### 2.`userQueryVo`è®¾ä¸ºnull,åˆ™`userCustom`ä¸ºnull

```java
//List<UserCustom> list = userMapper.findUserList(userQueryVo);
List<UserCustom> list = userMapper.findUserList(null);
```

è¾“å‡º

```
DEBUG [main] - Created connection 1859039536.
DEBUG [main] - Setting autocommit to false on JDBC Connection [com.mysql.jdbc.JDBC4Connection@6eceb130]
DEBUG [main] - ==>  Preparing: select * from user 
DEBUG [main] - ==> Parameters: 
DEBUG [main] - <==      Total: 15
[id:1
username:ç‹äº”
sex:2
birthday:Tue Nov 05 00:00:00 CST 2019
address:null, id:10
username:å¼ ä¸‰
sex:1
birthday:Wed Nov 06 00:00:00 CST 2019
address:åŒ—äº¬å¸‚, id:22
username:å¼ æ™“æ˜
sex:1
birthday:Tue Nov 26 00:00:00 CST 2019
address:å¤©æ´¥, id:24
username:é™ˆæ™“æ˜
sex:1
birthday:Tue Apr 04 00:00:00 CST 2017
address:é‡åº†, id:26
username:å°æ˜
sex:1
birthday:Tue Jul 24 00:00:00 CST 2018
address:æ­¦æ±‰, id:27
username:å®‹æ±Ÿæ¶›new2
sex:ç”·
birthday:Sun Nov 03 00:00:00 CST 2019
address:å±±è¥¿å¤ªåŸnew, id:28
username:ææ¢…æ¢…
sex:1
birthday:Wed Jul 26 00:00:00 CST 2000
address:è¥¿å®‰, id:29
username:ä¸½ä¸½
sex:2
birthday:Tue Oct 29 00:00:00 CST 2019
address:æ–°ç–†, id:31
username:æ¶µæ¶µ
sex:2
birthday:Tue Jun 12 00:00:00 CST 2018
address:è¥¿è—, id:32
username:æ±Ÿæ±Ÿ
sex:1
birthday:Wed Jul 05 00:00:00 CST 2017
address:å®å¤, id:33
username:çº¢çº¢
sex:1
birthday:Tue Jun 20 00:00:00 CST 2017
address:å¹¿å·, id:34
username:æœ¨æœ¨
sex:1
birthday:Tue Apr 26 00:00:00 CST 2016
address:æ²³åŒ—, id:35
username:å®‹æ±Ÿæ¶›
sex:ç”·
birthday:Sun Nov 03 00:00:00 CST 2019
address:å±±è¥¿, id:36
username:å¼ å®‡
sex:2
birthday:Sun Nov 03 00:00:00 CST 2019
address:è¥„é˜³, id:37
username:é™ˆæ™“æ˜
sex:1
birthday:Wed Nov 27 00:00:00 CST 2019
address:null]
```

å¯ä»¥çœ‹åˆ°sqlè¯­å¥å˜ä¸ºäº†`SELECT * FROM user`

## 3. sqlç‰‡æ®µ(é‡ç‚¹)

å°†ä¸Šè¾¹å®ç°çš„åŠ¨æ€sqlåˆ¤æ–­ä»£ç å—æŠ½å–å‡ºæ¥ï¼Œç»„æˆä¸€ä¸ªsqlç‰‡æ®µã€‚å…¶å®ƒçš„statementä¸­å°±å¯ä»¥å¼•ç”¨sqlç‰‡æ®µã€‚


### 3.1 å®šä¹‰sqlç‰‡æ®µ

```xml
<!-- å®šä¹‰sqlç‰‡æ®µ
idï¼šsqlç‰‡æ®µçš„å”¯ ä¸€æ ‡è¯†

ç»éªŒï¼šæ˜¯åŸºäºå•è¡¨æ¥å®šä¹‰sqlç‰‡æ®µï¼Œè¿™æ ·è¯è¿™ä¸ªsqlç‰‡æ®µå¯é‡ç”¨æ€§æ‰é«˜
åœ¨sqlç‰‡æ®µä¸­ä¸è¦åŒ…æ‹¬ where
 -->
<sql id="query_user_where">
    <if test="userCustom!=null">
        <if test="userCustom.sex!=null and userCustom.sex!=''">
            AND user.sex = ##{userCustom.sex}
        </if>
        <if test="userCustom.username!=null and userCustom.username!=''">
            AND user.username LIKE '%${userCustom.username}%'
        </if>
    </if>
</sql>
```

### 3.2 å¼•ç”¨sqlç‰‡æ®µ

```xml
<!-- ç”¨æˆ·ä¿¡æ¯ç»¼åˆæŸ¥è¯¢
    ##{userCustom.sex}:å–å‡ºpojoåŒ…è£…å¯¹è±¡ä¸­æ€§åˆ«å€¼
    ${userCustom.username}ï¼šå–å‡ºpojoåŒ…è£…å¯¹è±¡ä¸­ç”¨æˆ·åç§°
 -->
<select id="findUserList" parameterType="com.iot.mybatis.po.UserQueryVo"
        resultType="com.iot.mybatis.po.UserCustom">
    SELECT * FROM user
    <!--  where å¯ä»¥è‡ªåŠ¨å»æ‰æ¡ä»¶ä¸­çš„ç¬¬ä¸€ä¸ªand -->
    <where>
        <!-- å¼•ç”¨sqlç‰‡æ®µ çš„idï¼Œå¦‚æœrefidæŒ‡å®šçš„idä¸åœ¨æœ¬mapperæ–‡ä»¶ä¸­ï¼Œéœ€è¦å‰è¾¹åŠ namespace -->
        <include refid="query_user_where"></include>
        <!-- åœ¨è¿™é‡Œè¿˜å¯ä»¥å¼•ç”¨å…¶å®ƒçš„sqlç‰‡æ®µ  -->
    </where>
</select>
```

## 4. foreachæ ‡ç­¾

å‘sqlä¼ é€’æ•°ç»„æˆ–Listï¼Œmybatisä½¿ç”¨foreachè§£æ

åœ¨ç”¨æˆ·æŸ¥è¯¢åˆ—è¡¨å’ŒæŸ¥è¯¢æ€»æ•°çš„statementä¸­å¢åŠ å¤šä¸ªidè¾“å…¥æŸ¥è¯¢ã€‚ä¸¤ç§æ–¹æ³•ï¼Œsqlè¯­å¥å¦‚ä¸‹ï¼š

- `SELECT * FROM USER WHERE id=1 OR id=10 OR id=16`
- `SELECT * FROM USER WHERE id IN(1,10,16)`

ä¸€ä¸ªä½¿ç”¨OR,ä¸€ä¸ªä½¿ç”¨IN


### 4.1 åœ¨è¾“å…¥å‚æ•°ç±»å‹ä¸­æ·»åŠ `List<Integer> ids`ä¼ å…¥å¤šä¸ªid

```java
public class UserQueryVo {

    //ä¼ å…¥å¤šä¸ªid
   private List<Integer> ids;

    public List<Integer> getIds() {
        return ids;
    }

    public void setIds(List<Integer> ids) {
        this.ids = ids;
    }
}
```

### 4.2 ä¿®æ”¹mapper.xml

```xml
 select * from user
 <where>
    <if test="ids!=null">
        <!-- ä½¿ç”¨ foreachéå†ä¼ å…¥ids
        collectionï¼šæŒ‡å®šè¾“å…¥ å¯¹è±¡ä¸­é›†åˆå±æ€§
        itemï¼šæ¯ä¸ªéå†ç”Ÿæˆå¯¹è±¡ä¸­
        openï¼šå¼€å§‹éå†æ—¶æ‹¼æ¥çš„ä¸²
        closeï¼šç»“æŸéå†æ—¶æ‹¼æ¥çš„ä¸²
        separatorï¼šéå†çš„ä¸¤ä¸ªå¯¹è±¡ä¸­éœ€è¦æ‹¼æ¥çš„ä¸²
        -->
        <!-- ä½¿ç”¨å®ç°ä¸‹è¾¹çš„sqlæ‹¼æ¥ï¼š
        AND (id=1 OR id=10 OR id=16)
        -->
        <foreach collection="ids" item="user_id" open="AND (" close=")" separator="or">
            <!-- æ¯ä¸ªéå†éœ€è¦æ‹¼æ¥çš„ä¸² -->
            id=##{user_id}
        </foreach>
        
        <!-- å®ç°  â€œ and id IN(1,10,16)â€æ‹¼æ¥ -->
        <!-- <foreach collection="ids" item="user_id" open="and id IN(" close=")" separator=",">
            æ¯ä¸ªéå†éœ€è¦æ‹¼æ¥çš„ä¸²
            ##{user_id}
        </foreach> -->
    </if>
</where>
```


### 4.3 æµ‹è¯•ä»£ç 

åœ¨`testFindUserList`ä¸­åŠ å…¥

```java
//ä¼ å…¥å¤šä¸ªid
List<Integer> ids = new ArrayList<Integer>();
ids.add(1);
ids.add(10);
ids.add(16);
//å°†idsé€šè¿‡userQueryVoä¼ å…¥statementä¸­
userQueryVo.setIds(ids);
```



## END é“¾æ¥
+ [å›åˆ°ç›®å½•](../README.md)
+ [ä¸Šä¸€èŠ‚](34.md)
+ [ä¸‹ä¸€èŠ‚](36.md)
---
+ [å‚ä¸è´¡çŒ®â¤ï¸ğŸ’•ğŸ’•](https://github.com/3293172751/Block_Chain/blob/master/Git/git-contributor.md)